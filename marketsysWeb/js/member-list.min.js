var ip = "192.168.0.54";
var loginName = null;
var pageNum = 1;

function getUserlist() {
	$.ajax({
		type: "GET",
		url: "http://" + ip + "/bcat/user/userPage.do?pageNo=" + pageNum + "&jsonp=?",
		dataType: "jsonp",
		success: function(d) {
			var b = "";
			var c = "";
			var a = "";
			sessionStorage.setItem("totalPage", d.result.totalPage);
			$.each(d.result.userList, function(g, h) {
				b = getGender(h.gender);
				c = getAge(h.birthday);
				var e = parseInt(d.result.pageNo);
				var f = parseInt(g);
				if(h.userStatus === "0") {}
				$("#DataTables_Table_0_info span:first-child").html((e - 2) * 10 + f + 2);
				$("#DataTables_Table_0_info span:last-child").html((e - 2) * 10 + f + 11)
			});
			$("#tbody").html(a);
			$("#totalRecord").html(d.result.totalRecord)
		}
	})
}
getUserlist();

function getAge(b) {
	var a = new Date(new Date().getTime() - b).getFullYear() - 1970;
	if(a < 0) {
		a = -a
	}
	return a
}

function getGender(a) {
	if(a === "1") {
		return "男"
	} else {
		if(a === "2") {
			return "女"
		}
	}
}
var previous = document.getElementById("DataTables_Table_0_previous");
previous.onclick = function() {
	next.style.opacity = "1";
	if(pageNum > 1) {
		pageNum--;
		previous.style.opacity = "1";
		getUserlist();
		$("#DataTables_Table_0_paginate>span>a").html(pageNum);
		if(pageNum == 1) {
			previous.style.opacity = "0"
		}
	}
};
var next = document.getElementById("DataTables_Table_0_next");
var totalPage = sessionStorage.getItem("totalPage");
next.onclick = function() {
	previous.style.opacity = "1";
	if(pageNum < totalPage) {
		pageNum++;
		next.style.opacity = "1";
		getUserlist();
		$("#DataTables_Table_0_paginate>span>a").html(pageNum);
		if(pageNum == totalPage) {
			next.style.opacity = "0"
		}
	}
};
$("#tbody").on("click", "tr>td:last-child>a[title='删除']", function() {
	var b = this.parentNode;
	var a = b.getAttribute("data-transId");
	sessionStorage.setItem("transPrivateId", a);
	member_del(this, sessionStorage.getItem("transPrivateId"))
});

function member_del(a, b) {
	layer.confirm("确认要删除吗？", function(c) {
		$.ajax({
			type: "POST",
			url: "http://" + ip + "/bcat/privateLette/removeLette.do?jsonp=?",
			data: {
				Id: sessionStorage.getItem("transPrivateId")
			},
			dataType: "jsonp",
			success: function(d) {
				if(d.code === "2000") {
					$(a).parents("tr").remove();
					layer.msg("已删除!", {
						icon: 1,
						time: 1000
					});
					getUserPrivateStatus()
				} else {
					layer.msg("删除失败!", {
						icon: 1,
						time: 1000
					})
				}
			}
		})
	})
};